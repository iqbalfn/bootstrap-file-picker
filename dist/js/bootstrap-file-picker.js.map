{"version":3,"file":"bootstrap-file-picker.js","sources":["../../src/js/file-picker.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap File Picker (v0.0.1): file-picker.js\n * --------------------------------------------------------------------------\n */\n\nimport $ from 'jquery'\n\nconst Default = {\n    multiple    : false,\n    type        : '*/*',\n    btnUpload   : 'Upload',\n    thumbnails  : null,\n    search      : null,\n    upload      : null,\n    selected    : null\n}\n\nclass FilePicker {\n\n    constructor(config){\n        this._config    = this._getConfig(config)\n        this._el        = {}\n        \n        this._files     = []\n        this._items     = []\n        this._paths     = []\n\n        this._query     = ''\n        this._uploader  = 0\n        this._timer     = null\n\n        this._makeDrawer()\n        this._addElementsListener()\n\n        $(this._el.drawer).drawer('show');\n    }\n\n    // private\n\n    _addElementsListener(){\n        // drawer showing\n        $(this._el.drawer).on('show.bs.drawer', e => {\n            this._footerHide()\n        })\n        \n        // drawer shown\n        $(this._el.drawer).on('shown.bs.drawer', e => {\n\n            // calculate the spinner position\n            if(this._el.dhSearchInput){\n                let inpWidth    = this._el.dhSearchInput.offsetWidth\n                let inpPadRight = parseFloat( $(this._el.dhSearchInput).css('padding-left') )\n                this._el.dhSearchSpinner.style.left = ( inpWidth - ( inpPadRight * 2.5 ) ) + 'px'\n\n                this._spinnerHide()\n                this._el.dhSearchInput.focus()\n            }\n\n            // find preset files\n            this._searchQuery('')\n        })\n\n        // drawer hiding\n        $(this._el.drawer).on('hide.bs.drawer', e => {\n            if(this._uploader)\n                e.preventDefault()\n        })\n\n        // drawer hidden\n        $(this._el.drawer).on('hidden.bs.drawer', e => {\n            $(this._el.drawer).remove()\n        })\n\n        // input search\n        if(this._el.dhSearchInput){\n            $(this._el.dhSearchInput).on('input', e => {\n                if(this._timer)\n                    clearTimeout(this._timer)\n\n                this._query = this._el.dhSearchInput.value\n                this._timer = setTimeout(q => this._searchQuery(q), 500, this._query)\n            })\n        }\n\n        // file list click\n        $(this._el.drawerBody).on('click', '.filepicker-item-selectable', e => {\n            let item = e.currentTarget\n\n            if(!this._config.multiple){\n                $(this._el.drawerBody)\n                    .children('.filepicker-item-active')\n                    .removeClass('filepicker-item-active')\n            }\n\n            let path = $(item).data('filepicker.item').path\n\n            if(item.classList.toggle('filepicker-item-active')){\n                this._paths.push(path)\n            }else{\n                this._paths.splice(this._paths.indexOf(path), 1)\n            }\n\n            this._footerUpdate()\n        })\n\n        // file list error click\n        $(this._el.drawerBody).on('click', '.filepicker-item-error', e => {\n            let item = e.currentTarget\n            item.style.opacity = 0\n            setTimeout(item => $(item).remove(), 300, item)\n        })\n\n        // clicking the select button\n        $(this._el.dfBtnSelect).click(e => {\n            let result = []\n            $(this._el.drawerBody)\n                .children('.filepicker-item-active')\n                .each((i,e) => result.push( $(e).data('filepicker.item') ))\n\n            if(this._config.selected)\n                this._config.selected.call(this, result)\n\n            $(this._el.drawer).drawer('hide')\n        })\n\n        if(this._el.dhUploadInput){\n            $(this._el.dhUploadInput).on('change', e => {\n                let files = this._el.dhUploadInput.files\n                if(!files.length)\n                    return\n\n                this._clearResult()\n\n                for(let i=0; i<files.length; i++){\n                    let file = files[i]\n                    let el   = this._renderItem(file, true, null, false, false)\n                    let prog = $(el).find('.progress-bar').get(0)\n\n                    // start upload the file\n                    this._uploader++\n                    this._footerUpdate()\n                    this._config.upload.call(this, file, prog, res => {\n                        this._uploader--\n\n                        if(typeof res === 'string'){\n                            res = this._hs(res)\n                            $(prog).parent().replaceWith(`<small class=\"text-danger\">${res}</small>`)\n                            el.classList.add('filepicker-item-error')\n                        }else{\n                            let nel = this._renderItem(res, false, el, false, true)\n\n                            if(nel)\n                                nel.click()\n                            else\n                                $(el).remove()\n                        }\n                        this._footerUpdate()\n                    })\n                }\n                this._el.dhUploadForm.reset()\n            })\n        }\n    }\n\n    _clearResult(){\n        $(this._el.drawerBody)\n            .find('.filepicker-item-clearable')\n            .not('.filepicker-item-active')\n            .each((i,e) => $(e).remove())\n        \n        this._footerUpdate()\n    }\n\n    _getConfig(config){\n        let conf = {}\n        for(let k in Default)\n            conf[k] = typeof config[k] === 'undefined' ? Default[k] : config[k]\n        return conf\n    }\n\n    _hs(text){\n        return text\n          .replace(/&/g, \"&amp;\")\n          .replace(/</g, \"&lt;\")\n          .replace(/>/g, \"&gt;\")\n          .replace(/\"/g, \"&quot;\")\n          .replace(/'/g, \"&#039;\");\n    }\n\n    _makeDrawer(){\n        let header      = ''\n        let multiText   = this._config.multiple ? ' multiple' : ''\n\n        // Searchable\n        if(this._config.search){\n            let upform = ``\n\n            // Uploadable\n            if(this._config.upload){\n                upform = `\n                    <form class=\"input-group-append\" data-el=\"dh-upload-form\">\n                        <label class=\"btn btn-outline-secondary\" data-el=\"dh-upload-label\">\n                            <input type=\"file\" accept=\"${this._config.type}\" data-el=\"dh-upload-input\"${multiText}>\n                        </label>\n                    </form>`\n            }\n\n            header = `\n                <div class=\"form-group\">\n                    <div class=\"input-group\">\n                        <input type=\"search\" class=\"form-control\" placeholder=\"Search\" aria-label=\"Search\" data-el=\"dh-search-input\">\n                        ${upform}\n                    </div>\n                    <div class=\"spinner-border spinner-border-sm text-secondary\" role=\"status\" data-el=\"dh-search-spinner\"></div>\n                </div>`\n\n        // Uploadable only\n        }else if(this._config.upload){\n            header = `\n                <form data-el=\"dh-upload-form\">\n                    <label class=\"btn btn-block btn-outline-primary\" data-el=\"dh-upload-label\">\n                        <input type=\"file\" accept=\"${this._config.type}\" data-el=\"dh-upload-input\"${multiText}>\n                    </label>\n                </form>`\n        }\n\n        let tmpl = `\n            <div class=\"drawer slide drawer-right filepicker-container\">\n                <div class=\"drawer-content drawer-content-scrollable\">\n                    <div class=\"drawer-header\">${header}</div>\n                    <div class=\"drawer-body\" data-el=\"drawer-body\"></div>\n                    <div class=\"drawer-footer\" data-el=\"drawer-footer\">\n                        <button class=\"btn btn-primary btn-block\" data-el=\"df-btn-select\">\n                            Select\n                        </button>\n                    </div>\n                </div>\n            </div>`;\n\n        this._el.drawer = $(tmpl).appendTo(document.body).get(0)\n\n        // find identified elements\n        $(this._el.drawer).find('[data-el]').each((i,e) => {\n            let name = e.dataset.el.replace(/\\-[a-z]/g, m => m[1].toUpperCase())\n            this._el[name] = e\n        })\n\n        // add upload label\n        $(this._el.dhUploadLabel).append(this._config.btnUpload)\n    }\n\n    _renderItem(item, uploader=false, replacer=null, removable=true, selectable=true){\n        if(!uploader){\n            if(this._paths.includes(item.path))\n                return\n        }\n\n        let safe = {\n            name  : this._hs(item.name),\n            type  : this._hs(item.type),\n            thumb : item.thumb || this._config.thumbnails\n        }\n\n        let clss = ' filepicker-item'\n        let progress = ''\n        \n        if(uploader){\n            clss+= ' filepicker-item-uploader'\n            progress = `\n                <div class=\"progress\">\n                    <div class=\"progress-bar progress-bar-striped progress-bar-animated\" style=\"width:0%\"></div>\n                </div>`\n        }\n\n        if(removable)\n            clss+= ' filepicker-item-clearable'\n        \n        if(selectable)\n            clss+= ' filepicker-item-selectable'\n\n        let tmpl = `\n            <div class=\"media${clss}\" title=\"${safe.name}\">\n                <img src=\"${safe.thumb}\" alt=\"#\" width=\"48\" height=\"48\">\n                <div class=\"media-body\">\n                    <h6>${safe.name}</h6>\n                    <small class=\"text-muted\">${safe.type}</small>\n                    ${progress}\n                </div>\n            </div>`\n\n        let el = $(tmpl).get(0)\n\n        if(uploader){\n            let img = $(el).children('img').get(0)\n            if(/image\\//.test(safe.type)){\n                let reader = new FileReader()\n                reader.onload = e => img.src = e.target.result\n                reader.readAsDataURL(item)\n            }\n        }else{\n            $(el).data('filepicker.item', item)\n        }\n\n        if(replacer)\n            $(replacer).replaceWith(el)\n        else\n            $(this._el.drawerBody).append(el)\n\n        return el\n    }\n\n    _searchQuery(query){\n        this._clearResult()\n        this._spinnerShow()\n\n        if(!this._config.search)\n            return\n\n        this._config.search(query, this._config.type, res => {\n            if(query != this._query)\n                return\n            this._spinnerHide()\n            \n            if(!res)\n                return\n\n            res.forEach(item => this._renderItem(item))\n        })\n    }\n\n    // Toogler\n    _footerHide(){\n        this._el.drawerFooter.style.display = 'none'\n    }\n    _footerShow(){\n        this._el.drawerFooter.style.display = 'flex'\n    }\n    _footerUpdate(){\n        if(this._uploader)\n            return this._footerHide()\n\n        if($(this._el.drawerBody).children('.filepicker-item-active').length)\n            this._footerShow()\n        else\n            this._footerHide()\n    }\n\n    _spinnerHide(){\n        if(this._el.dhSearchSpinner)\n            this._el.dhSearchSpinner.style.display = 'none'\n    }\n    _spinnerShow(){\n        if(this._el.dhSearchSpinner)\n            this._el.dhSearchSpinner.style.display = 'block'\n    }\n}\n\nwindow.FilePicker = FilePicker\nexport default FilePicker"],"names":["Default","multiple","type","btnUpload","thumbnails","search","upload","selected","FilePicker","config","_config","_getConfig","_el","_files","_items","_paths","_query","_uploader","_timer","_makeDrawer","_addElementsListener","$","drawer","on","e","_footerHide","dhSearchInput","inpWidth","offsetWidth","inpPadRight","parseFloat","css","dhSearchSpinner","style","left","_spinnerHide","focus","_searchQuery","preventDefault","remove","clearTimeout","value","setTimeout","q","drawerBody","item","currentTarget","children","removeClass","path","data","classList","toggle","push","splice","indexOf","_footerUpdate","opacity","dfBtnSelect","click","result","each","i","call","dhUploadInput","files","length","_clearResult","file","el","_renderItem","prog","find","get","res","_hs","parent","replaceWith","add","nel","dhUploadForm","reset","not","conf","k","text","replace","header","multiText","upform","tmpl","appendTo","document","body","name","dataset","m","toUpperCase","dhUploadLabel","append","uploader","replacer","removable","selectable","includes","safe","thumb","clss","progress","img","test","reader","FileReader","onload","src","target","readAsDataURL","query","_spinnerShow","forEach","drawerFooter","display","_footerShow","window"],"mappings":"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"}